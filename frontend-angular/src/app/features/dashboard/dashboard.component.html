<div class="dashboard-container">
  <!-- Header con KPIs globales -->
  <div class="kpis-grid">
    <mat-card class="kpi-card total-recaudo">
      <div class="kpi-header">
        <mat-icon>account_balance</mat-icon>
        <span class="kpi-period">Año 2024</span>
      </div>
      <div class="kpi-value">$486.2B</div>
      <div class="kpi-label">Recaudo Total</div>
      <div class="kpi-change positive">
        <mat-icon>trending_up</mat-icon>
        +18.4% vs 2023
      </div>
    </mat-card>

    <mat-card class="kpi-card total-facturado">
      <div class="kpi-header">
        <mat-icon>description</mat-icon>
        <span class="kpi-period">Facturado</span>
      </div>
      <div class="kpi-value">$612.8B</div>
      <div class="kpi-label">Total Facturado</div>
      <div class="kpi-change">
        <mat-icon>check_circle</mat-icon>
        79.3% efectividad
      </div>
    </mat-card>

    <mat-card class="kpi-card cartera">
      <div class="kpi-header">
        <mat-icon>account_balance_wallet</mat-icon>
        <span class="kpi-period">Pendiente</span>
      </div>
      <div class="kpi-value">$126.6B</div>
      <div class="kpi-label">Cartera Activa</div>
      <div class="kpi-change warning">
        <mat-icon>warning</mat-icon>
        20.7% pendiente
      </div>
    </mat-card>

    <mat-card class="kpi-card contribuyentes">
      <div class="kpi-header">
        <mat-icon>people</mat-icon>
        <span class="kpi-period">Activos</span>
      </div>
      <div class="kpi-value">{{ 45678 | number }}</div>
      <div class="kpi-label">Contribuyentes</div>
      <div class="kpi-change">
        <mat-icon>add_circle</mat-icon>
        +2.3K nuevos
      </div>
    </mat-card>
  </div>

  <!-- Recaudo por Fuente -->
  <mat-card class="fuentes-recaudo-card">
    <mat-card-header>
      <mat-card-title>Recaudo por Fuente de Ingreso</mat-card-title>
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item>
          <mat-icon>download</mat-icon>
          Exportar Excel
        </button>
        <button mat-menu-item>
          <mat-icon>print</mat-icon>
          Imprimir
        </button>
      </mat-menu>
    </mat-card-header>
    <mat-card-content>
      <div class="fuente-recaudo-item" *ngFor="let fuente of fuentesRecaudo()">
        <div class="fuente-info">
          <div class="fuente-icon" [style.background-color]="fuente.color + '20'">
            <mat-icon [style.color]="fuente.color">{{ fuente.icono }}</mat-icon>
          </div>
          <div class="fuente-details">
            <div class="fuente-nombre">{{ fuente.nombre }}</div>
            <div class="fuente-objetos">{{ fuente.objetos | number }} objetos</div>
          </div>
        </div>
        <div class="fuente-stats">
          <div class="stat-item">
            <div class="stat-label">Facturado</div>
            <div class="stat-value">{{ fuente.facturado }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Recaudado</div>
            <div class="stat-value recaudado">{{ fuente.recaudado }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Efectividad</div>
            <div class="stat-value" [class.high]="fuente.efectividad >= 80" [class.medium]="fuente.efectividad >= 60 && fuente.efectividad < 80" [class.low]="fuente.efectividad < 60">
              {{ fuente.efectividad }}%
            </div>
          </div>
        </div>
        <div class="fuente-progress">
          <mat-progress-bar 
            mode="determinate" 
            [value]="fuente.efectividad"
            [class.high]="fuente.efectividad >= 80"
            [class.medium]="fuente.efectividad >= 60 && fuente.efectividad < 80"
            [class.low]="fuente.efectividad < 60">
          </mat-progress-bar>
        </div>
        <button mat-icon-button [routerLink]="['/fuentes', fuente.id]" matTooltip="Ver detalle">
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Grid de accesos rápidos y gráficas -->
  <div class="dashboard-grid">
    <mat-card class="quick-actions-card">
      <mat-card-header>
        <mat-card-title>Accesos Rápidos</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <button mat-raised-button color="primary" routerLink="/liquidaciones" class="action-button">
          <mat-icon>calculate</mat-icon>
          Nueva Liquidación
        </button>
        <button mat-raised-button routerLink="/fuentes" class="action-button">
          <mat-icon>account_balance</mat-icon>
          Gestionar Fuentes
        </button>
        <button mat-raised-button routerLink="/facturas" class="action-button">
          <mat-icon>description</mat-icon>
          Consultar Facturas
        </button>
        <button mat-raised-button routerLink="/pagos" class="action-button">
          <mat-icon>payment</mat-icon>
          Registrar Pago
        </button>
      </mat-card-content>
    </mat-card>

    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>Recaudo Mensual 2024</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-placeholder">
          <mat-icon>bar_chart</mat-icon>
          <p>Gráfica de recaudo mensual</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

