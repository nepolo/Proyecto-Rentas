# ğŸ¯ GuÃ­a RÃ¡pida - Motor de LiquidaciÃ³n Tributaria

## ğŸš€ Â¿QuÃ© es?

El **Motor de LiquidaciÃ³n Tributaria** es el corazÃ³n del sistema, permitiendo:

- âœ… Crear **fuentes de ingreso** y **conceptos de cobro** personalizados
- âœ… Definir **tipos de liquidaciÃ³n** con flujos especÃ­ficos
- âœ… Generar liquidaciones **individuales** o **masivas**
- âœ… **Reliquidar** y hacer **ajustes** con trazabilidad completa
- âœ… Ver cada renta en su propia vista con estadÃ­sticas

---

## ğŸ“¸ Capturas del Sistema

### Vista Principal - Tabs
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Motor de LiquidaciÃ³n Tributaria                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [+ Nueva]  [âš¡ Masiva]                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Liquidaciones â”‚ ğŸ’° Fuentes â”‚ ğŸ“Š Conceptos â”‚ ğŸ“ˆ Statsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Filtros Inteligentes
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” [Buscar...]  ğŸ“… [2024] [1] [Todos]â”‚
â”‚                                        â”‚
â”‚ Filtros activos:                       â”‚
â”‚ [Estado: APROBADA âœ•] [Vigencia: 2024 âœ•]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vista Cards (MÃ³vil)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ #LIQ-2024-001         â”‚  â”‚ ğŸŸ  #LIQ-2024-002         â”‚
â”‚ Juan PÃ©rez               â”‚  â”‚ MarÃ­a GarcÃ­a             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ Renta: Predial           â”‚  â”‚ Renta: ICA               â”‚
â”‚ Periodo: 2024/1          â”‚  â”‚ Periodo: 2024/1          â”‚
â”‚ Base: $50,000,000        â”‚  â”‚ Base: $120,000,000       â”‚
â”‚ Total: $500,000          â”‚  â”‚ Total: $1,200,000        â”‚
â”‚ [APROBADA]               â”‚  â”‚ [PENDIENTE]              â”‚
â”‚ [Ver Detalle] [Acciones] â”‚  â”‚ [Ver Detalle] [Aprobar]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vista Tabla (Desktop)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #          â”‚ Contribuyente â”‚ Renta   â”‚ Periodo â”‚ Total       â”‚ Estado    â”‚ âš™ï¸   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LIQ-001    â”‚ Juan PÃ©rez    â”‚ Predial â”‚ 2024/1  â”‚ $500,000    â”‚ [APROBADA]â”‚ â‹®  â”‚
â”‚ LIQ-002    â”‚ MarÃ­a GarcÃ­a  â”‚ ICA     â”‚ 2024/1  â”‚ $1,200,000  â”‚ [PENDIENTE]â”‚ â‹®  â”‚
â”‚ LIQ-003    â”‚ Pedro LÃ³pez   â”‚ Predial â”‚ 2024/1  â”‚ $750,000    â”‚ [APROBADA]â”‚ â‹®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        [< Anterior]  [1 2 3 ... 10]  [Siguiente >]
```

---

## ğŸ¯ Casos de Uso Principales

### 1ï¸âƒ£ Crear Fuente de Ingreso
```
1. Ir a tab "Fuentes de Ingreso"
2. Click en "Nueva Fuente"
3. Llenar:
   - CÃ³digo: "IMP_PREDIAL"
   - Nombre: "Impuesto Predial"
   - DescripciÃ³n: "Impuesto sobre la propiedad inmueble"
   - Estado: ACTIVO
4. Guardar
```

### 2ï¸âƒ£ Crear Conceptos de Cobro para una Fuente
```
1. Seleccionar fuente "Impuesto Predial"
2. En tab "Conceptos de Cobro" click "Nuevo Concepto"
3. Crear cada concepto:
   
   a) Impuesto Base
      - Obligatorio: SÃ­
      - Vincula fÃ³rmula: "CALCULO_PREDIAL_BASE"
      - Orden: 1
   
   b) Sobretasa Ambiental
      - Obligatorio: No
      - Vincula fÃ³rmula: "SOBRETASA_AMB"
      - Orden: 2
   
   c) Alumbrado PÃºblico
      - Obligatorio: SÃ­
      - Permite cero: SÃ­
      - Orden: 3
```

### 3ï¸âƒ£ Crear Tipo de LiquidaciÃ³n
```
1. Tab "Tipos de LiquidaciÃ³n"
2. "Nuevo Tipo"
3. Configurar:
   - Nombre: "LiquidaciÃ³n Oficial Predial"
   - Conceptos incluidos:
     âœ“ Impuesto Base
     âœ“ Sobretasa Ambiental  
     âœ“ Alumbrado PÃºblico
   - Genera factura: SÃ­
   - Requiere aprobaciÃ³n: SÃ­
```

### 4ï¸âƒ£ LiquidaciÃ³n Individual
```
1. Click "Nueva LiquidaciÃ³n"
2. Wizard:
   
   Paso 1: Datos BÃ¡sicos
   - Contribuyente: [Buscar/Seleccionar]
   - Renta: Predial
   - Tipo: LiquidaciÃ³n Oficial Predial
   - Periodo: 2024/1
   
   Paso 2: Conceptos
   Sistema muestra conceptos del tipo seleccionado:
   
   ğŸ“ Impuesto Base
      Base gravable: $50,000,000
      Tarifa: 0.5%
      [Calcular] â†’ Valor: $250,000
   
   ğŸ“ Sobretasa Ambiental
      Base: $50,000,000
      Tarifa: 0.2%
      [Calcular] â†’ Valor: $100,000
   
   ğŸ“ Alumbrado PÃºblico
      Valor fijo: $50,000
   
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOTAL: $400,000
   
   Paso 3: Confirmar
   [Guardar Borrador] [Enviar a AprobaciÃ³n]
```

### 5ï¸âƒ£ LiquidaciÃ³n Masiva
```
1. Click "LiquidaciÃ³n Masiva"
2. Configurar:
   
   ğŸ“‹ Datos Generales
   - Nombre: "Predial 2024 - Trimestre 1"
   - Tipo: LiquidaciÃ³n Oficial Predial
   - Periodo: 2024/1
   
   ğŸ¯ Criterios de SelecciÃ³n
   - Renta: Predial
   - Actividad: ["Residencial", "Comercial"]
   - Excluir: [Contribuyentes con saldo]
   
   ğŸ‘¥ Preview
   Total contribuyentes: 1,247
   [Ver listado]
   
3. [Ejecutar Proceso]

4. Monitor en tiempo real:
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 65% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Procesados: 811 / 1,247
   Exitosos: 805
   Fallidos: 6
   [Ver errores] [Pausar]
```

### 6ï¸âƒ£ Reliquidar (Hacer Ajustes)
```
1. Seleccionar liquidaciÃ³n APROBADA
2. Click "â‹®" â†’ "Reliquidar"
3. Sistema muestra datos actuales
4. Modificar lo necesario:
   
   Concepto: Impuesto Base
   Base anterior: $50,000,000
   Base nueva:    $48,500,000  â† [Modificado]
   Motivo: "CorrecciÃ³n por avalÃºo catastral"
   
5. [Confirmar ReliquidaciÃ³n]

Resultado:
- LiquidaciÃ³n original â†’ ANULADA
- Nueva liquidaciÃ³n â†’ PENDIENTE
- Ambas vinculadas (trazabilidad)
- Registro en historial de ajustes
```

### 7ï¸âƒ£ Ver Liquidaciones por Renta
```
1. Tab "Liquidaciones"
2. Filtrar por:
   - Renta: Predial
   - Vigencia: 2024
   - Periodo: 1

Vista agrupada muestra:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š IMPUESTO PREDIAL - 2024/1     â”‚
â”‚                                   â”‚
â”‚ Total Liquidaciones: 1,247        â”‚
â”‚ Valor Total: $620,500,000         â”‚
â”‚ Promedio: $497,590                â”‚
â”‚                                   â”‚
â”‚ Estados:                          â”‚
â”‚  ğŸŸ¢ Aprobadas: 1,180 (95%)        â”‚
â”‚  ğŸŸ  Pendientes: 60 (5%)           â”‚
â”‚  ğŸ”´ Anuladas: 7 (0.5%)            â”‚
â”‚                                   â”‚
â”‚ [Ver Todas] [Exportar] [GrÃ¡ficos]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Listado de liquidaciones...]
```

---

## ğŸ”„ Flujos de Estado

```
BORRADOR
   â†“ [Enviar a aprobaciÃ³n]
PENDIENTE
   â†“ [Aprobar]          â†“ [Rechazar]
APROBADA              RECHAZADA
   â†“ [Facturar]
FACTURADA
   
   [Anular] â†’ ANULADA (desde cualquier estado)
   [Reliquidar] â†’ Nueva liquidaciÃ³n (PENDIENTE)
```

---

## ğŸ¨ Elementos UX Destacados

### BÃºsqueda Inteligente
- â±ï¸ Debounce de 400ms (no busca en cada tecla)
- ğŸ” Busca en: nÃºmero, contribuyente, renta
- ğŸ’¡ Sugiere mientras escribes

### Filtros con Chips
```
[Filtros aplicados:]
[Estado: APROBADA âœ•] [Vigencia: 2024 âœ•] [Periodo: 1 âœ•]
```
Click en âœ• para remover filtro individual

### Estados con Colores
- ğŸŸ¤ BORRADOR - Editable
- ğŸŸ  PENDIENTE - Espera aprobaciÃ³n  
- ğŸŸ¢ APROBADA - Lista para facturar
- ğŸ”µ FACTURADA - Completada
- ğŸ”´ ANULADA - Cancelada

### MenÃº Contextual (â‹®)
Acciones disponibles segÃºn estado:
```
â‹® MenÃº
â”œâ”€ ğŸ‘ï¸ Ver Detalle (todos)
â”œâ”€ âœï¸ Editar (solo BORRADOR)
â”œâ”€ âœ… Aprobar (solo PENDIENTE)
â”œâ”€ ğŸ”„ Reliquidar (APROBADA/FACTURADA)
â””â”€ âŒ Anular (excepto ANULADA)
```

### Toggle de Vista
```
[â–¦] Cards    [â˜°] Tabla
```
Click para cambiar entre vistas

---

## ğŸ“Š EstadÃ­sticas y Reportes

### Dashboard Principal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ESTADÃSTICAS GENERALES - 2024            â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ 1,247   â”‚ â”‚ ğŸ’° $620M   â”‚ â”‚ ğŸ“Š 95%   â”‚ â”‚
â”‚ â”‚ Total      â”‚ â”‚ Recaudado  â”‚ â”‚ Aprobado â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚
â”‚ Por Renta:                                   â”‚
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘ Predial    ($450M - 72%)       â”‚
â”‚ â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ ICA        ($120M - 19%)       â”‚
â”‚ â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ Otros      ($50M  - 9%)        â”‚
â”‚                                              â”‚
â”‚ Tendencia Mensual:                           â”‚
â”‚     â•±â•²                                       â”‚
â”‚    â•±  â•²    â•±â•²                                â”‚
â”‚   â•±    â•²  â•±  â•²   â•±                           â”‚
â”‚  â•±      â•²â•±    â•² â•±                            â”‚
â”‚ â•±              â•²                             â”‚
â”‚ E F M A M J J A S O N D                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Tips de Performance

### Para Datasets Grandes
1. âœ… Usa paginaciÃ³n (50-100 registros max)
2. âœ… Activa filtros antes de buscar
3. âœ… Vista tabla es mÃ¡s eficiente que cards para +100 registros
4. âœ… LiquidaciÃ³n masiva procesa en background

### Optimizaciones Implementadas
- ğŸš„ Server-side pagination
- â±ï¸ Debounce en bÃºsqueda (evita 10+ requests)
- ğŸ’¾ CachÃ© de catÃ¡logos (rentas, tipos, conceptos)
- ğŸ“¦ Lazy loading de mÃ³dulos
- ğŸ”„ Virtual scrolling (futuro para listas +1000)

---

## ğŸ“± Uso MÃ³vil

### Gestos Soportados
- ğŸ‘† **Tap:** Ver detalle
- ğŸ‘† **Long press:** MenÃº contextual
- ğŸ‘ˆ **Swipe left:** Siguiente pÃ¡gina
- ğŸ‘‰ **Swipe right:** PÃ¡gina anterior
- ğŸ” **Pinch zoom:** En grÃ¡ficos

### Vista MÃ³vil Optimizada
- Cards mÃ¡s grandes
- Botones de acciÃ³n mÃ¡s accesibles
- Filtros en panel lateral
- MenÃº hamburguesa

---

## ğŸ“ Casos Especiales

### Â¿QuÃ© pasa si hay error en liquidaciÃ³n masiva?
```
El proceso continÃºa con los demÃ¡s
Los errores se registran con:
- ID del contribuyente
- Motivo del error
- Sugerencia de soluciÃ³n

Al finalizar:
- Reporte de exitosos
- Reporte de fallidos
- OpciÃ³n de reprocesar solo los fallidos
```

### Â¿Puedo editar una liquidaciÃ³n APROBADA?
```
NO directamente.
Debes usar "Reliquidar" que:
1. Anula la original
2. Crea una nueva
3. Mantiene la trazabilidad
```

### Â¿CÃ³mo funcionan los conceptos obligatorios?
```
Al crear liquidaciÃ³n:
- Conceptos obligatorios: NO se pueden omitir
- Conceptos opcionales: Pueden agregarse o no
- Si "Permite cero": Puede tener valor 0
- Si NO permite cero: Debe tener valor > 0
```

---

## ğŸ”— Integraciones

El motor se integra con:
- âœ… **ParametrizaciÃ³n:** Usa rentas y configuraciones
- âœ… **FÃ³rmulas:** Aplica cÃ¡lculos automÃ¡ticos
- âœ… **FacturaciÃ³n:** Genera facturas automÃ¡ticas
- âœ… **Cartera:** Actualiza estados de cuenta
- âœ… **Notificaciones:** EnvÃ­a alertas y recordatorios

---

**Â¡El Motor de LiquidaciÃ³n Tributaria es el nÃºcleo del sistema moderno!** ğŸš€

Ver documentaciÃ³n completa en: `MOTOR_LIQUIDACION_DOCUMENTACION.md`
